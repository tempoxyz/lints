id: tracing-no-format
message: "Avoid format!() inside tracing macros. Use structured fields instead."
severity: warning
language: rust
note: |
  Using format!() in tracing macros loses structured logging benefits.
  
  Bad:
  ```rust
  tracing::info!("User {} logged in", format!("{:?}", user));
  tracing::info!(user = format!("{:?}", user), "logged in");
  ```
  
  Good:
  ```rust
  tracing::info!(user = ?user, "User logged in");
  ```
  
  Structured fields enable better log querying and reduce allocations.
  
  To disable this rule:
  - Line: add `// ast-grep-ignore: tracing-no-format` on the line before
rule:
  any:
    # format!() as last argument
    - pattern: tracing::info!($$$ARGS, format!($$$FMT))
    - pattern: tracing::debug!($$$ARGS, format!($$$FMT))
    - pattern: tracing::warn!($$$ARGS, format!($$$FMT))
    - pattern: tracing::error!($$$ARGS, format!($$$FMT))
    - pattern: tracing::trace!($$$ARGS, format!($$$FMT))
    - pattern: info!($$$ARGS, format!($$$FMT))
    - pattern: debug!($$$ARGS, format!($$$FMT))
    - pattern: warn!($$$ARGS, format!($$$FMT))
    - pattern: error!($$$ARGS, format!($$$FMT))
    - pattern: trace!($$$ARGS, format!($$$FMT))
    # format!() as first/only argument
    - pattern: tracing::info!(format!($$$FMT))
    - pattern: tracing::debug!(format!($$$FMT))
    - pattern: tracing::warn!(format!($$$FMT))
    - pattern: tracing::error!(format!($$$FMT))
    - pattern: tracing::trace!(format!($$$FMT))
    - pattern: info!(format!($$$FMT))
    - pattern: debug!(format!($$$FMT))
    - pattern: warn!(format!($$$FMT))
    - pattern: error!(format!($$$FMT))
    - pattern: trace!(format!($$$FMT))
    # format!() as first argument with trailing args
    - pattern: tracing::info!(format!($$$FMT), $$$ARGS)
    - pattern: tracing::debug!(format!($$$FMT), $$$ARGS)
    - pattern: tracing::warn!(format!($$$FMT), $$$ARGS)
    - pattern: tracing::error!(format!($$$FMT), $$$ARGS)
    - pattern: tracing::trace!(format!($$$FMT), $$$ARGS)
    - pattern: info!(format!($$$FMT), $$$ARGS)
    - pattern: debug!(format!($$$FMT), $$$ARGS)
    - pattern: warn!(format!($$$FMT), $$$ARGS)
    - pattern: error!(format!($$$FMT), $$$ARGS)
    - pattern: trace!(format!($$$FMT), $$$ARGS)
